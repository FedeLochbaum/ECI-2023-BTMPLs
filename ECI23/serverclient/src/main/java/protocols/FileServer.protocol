typestate FileServer {

  Init = {
    boolean start(Socket): <true: Connected, false: end>
  }

  Connected = {
    boolean hasRequest(): <true: Requested, false: Connected>
    void close(): end;
  }

  Requested = {
    boolean sendFile(String): <true: Sending, false: Connected>
    void close(): end;
  }

  Sending = {
    boolean sendNextByte(): <true: Sending, false: Connected>
  }
}
